# ========================================
# INSTRUCTIONS FLASK DB MIGRATE
# ========================================
# Compatible avec Windows, Linux et macOS
# ========================================

## ğŸš€ PRÃ‰REQUIS OBLIGATOIRES

### 1. Python et pip installÃ©s
- Python 3.8+ requis
- pip doit Ãªtre accessible depuis le terminal

### 2. Environnement virtuel activÃ©
```bash
# Windows (PowerShell/CMD)
venv\Scripts\activate

# Linux/macOS
source venv/bin/activate
```

### 3. DÃ©pendances installÃ©es
```bash
pip install -r requirements.txt
```

## ğŸ”§ CONFIGURATION DE LA BASE DE DONNÃ‰ES

### Variables d'environnement requises
CrÃ©er un fichier `.env` Ã  la racine du projet :

```env
# Configuration de base de donnÃ©es
DB_TYPE=mysql
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=
DB_NAME=PriceScan_db

# Ou pour SQLite (dÃ©veloppement)
DB_TYPE=sqlite
DB_PATH=./PriceScan.db

# Ou pour PostgreSQL
DB_TYPE=postgresql
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your_password
DB_NAME=PriceScan_db
```

## ğŸ“‹ INSTRUCTIONS PAR SYSTÃˆME D'EXPLOITATION

### ğŸªŸ WINDOWS

#### Option 1: PowerShell
```powershell
# 1. Ouvrir PowerShell en tant qu'administrateur
# 2. Naviguer vers le dossier du projet
cd "C:\Users\konat\OneDrive\Bureau\project\accademique\M2\Dev web Mobile\PriceScan\PriceScan-api"

# 3. Activer l'environnement virtuel
.\venv\Scripts\Activate.ps1

# 4. VÃ©rifier que Flask-Migrate est installÃ©
pip show flask-migrate

# 5. Initialiser les migrations (premiÃ¨re fois seulement)
flask db init

# 6. CrÃ©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

#### Option 2: Command Prompt (CMD)
```cmd
# 1. Ouvrir CMD en tant qu'administrateur
# 2. Naviguer vers le dossier du projet
cd "C:\Users\konat\OneDrive\Bureau\project\accademique\M2\Dev web Mobile\PriceScan\PriceScan-api"

# 3. Activer l'environnement virtuel
venv\Scripts\activate.bat

# 4. VÃ©rifier que Flask-Migrate est installÃ©
pip show flask-migrate

# 5. Initialiser les migrations (premiÃ¨re fois seulement)
flask db init

# 6. CrÃ©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

### ğŸ§ LINUX

#### Ubuntu/Debian
```bash
# 1. Ouvrir un terminal
# 2. Naviguer vers le dossier du projet
cd /path/to/PriceScan-api

# 3. Activer l'environnement virtuel
source venv/bin/activate

# 4. VÃ©rifier que Flask-Migrate est installÃ©
pip show flask-migrate

# 5. Initialiser les migrations (premiÃ¨re fois seulement)
flask db init

# 6. CrÃ©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

#### CentOS/RHEL/Fedora
```bash
# 1. Ouvrir un terminal
# 2. Naviguer vers le dossier du projet
cd /path/to/PriceScan-api

# 3. Activer l'environnement virtuel
source venv/bin/activate

# 4. VÃ©rifier que Flask-Migrate est installÃ©
pip show flask-migrate

# 5. Initialiser les migrations (premiÃ¨re fois seulement)
flask db init

# 6. CrÃ©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

### ğŸ macOS

#### Terminal natif
```bash
# 1. Ouvrir Terminal
# 2. Naviguer vers le dossier du projet
cd /path/to/PriceScan-api

# 3. Activer l'environnement virtuel
source venv/bin/activate

# 4. VÃ©rifier que Flask-Migrate est installÃ©
pip show flask-migrate

# 5. Initialiser les migrations (premiÃ¨re fois seulement)
flask db init

# 6. CrÃ©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

## ğŸ› ï¸ RÃ‰SOLUTION DES PROBLÃˆMES COURANTS

### Erreur: "flask command not found"
**Solution:**
```bash
# Installer Flask-Migrate
pip install flask-migrate

# Ou utiliser python -m flask
python -m flask db migrate -m "Initial migration"
```

### Erreur: "No module named 'flask_migrate'"
**Solution:**
```bash
# Installer Flask-Migrate
pip install flask-migrate

# VÃ©rifier l'installation
pip list | grep flask
```

### Erreur: "No module named 'config'"
**Solution:**
```bash
# S'assurer d'Ãªtre dans le bon rÃ©pertoire
pwd  # Linux/macOS
cd   # Windows

# VÃ©rifier la structure des dossiers
ls -la  # Linux/macOS
dir     # Windows
```

### Erreur: "Database connection failed"
**Solution:**
1. VÃ©rifier que la base de donnÃ©es est en cours d'exÃ©cution
2. VÃ©rifier les paramÃ¨tres de connexion dans `.env`
3. Tester la connexion manuellement

## ğŸ“ STRUCTURE DES MIGRATIONS

AprÃ¨s `flask db init`, la structure suivante sera crÃ©Ã©e :

```
PriceScan-api/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ versions/          # Fichiers de migration
â”‚   â”œâ”€â”€ alembic.ini       # Configuration Alembic
â”‚   â”œâ”€â”€ env.py            # Environnement de migration
â”‚   â”œâ”€â”€ README            # Documentation
â”‚   â””â”€â”€ script.py.mako    # Template pour les migrations
â”œâ”€â”€ .env                  # Variables d'environnement
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ constant.py       # Configuration de la base
â”‚   â””â”€â”€ db.py            # Initialisation de la base
â””â”€â”€ model/
    â””â”€â”€ PriceScan_db.py   # ModÃ¨les SQLAlchemy
```

## ğŸ”„ COMMANDES MIGRATION COMPLÃˆTES

### Initialisation (premiÃ¨re fois)
```bash
# Initialiser le systÃ¨me de migration
flask db init

# CrÃ©er la premiÃ¨re migration
flask db migrate -m "Initial database schema"

# Appliquer la migration
flask db upgrade
```

### Migrations suivantes
```bash
# CrÃ©er une nouvelle migration
flask db migrate -m "Description des changements"

# Appliquer la migration
flask db upgrade

# Annuler la derniÃ¨re migration
flask db downgrade
```

### Gestion des migrations
```bash
# Voir l'historique des migrations
flask db history

# Voir le statut actuel
flask db current

# Voir les migrations disponibles
flask db show
```

## ğŸš¨ POINTS D'ATTENTION

### 1. Sauvegarde
- Toujours sauvegarder la base avant une migration
- Tester les migrations sur un environnement de dÃ©veloppement

### 2. Ordre des opÃ©rations
- Toujours faire `migrate` avant `upgrade`
- VÃ©rifier le contenu des migrations gÃ©nÃ©rÃ©es

### 3. Environnement
- S'assurer que l'environnement virtuel est activÃ©
- VÃ©rifier que toutes les dÃ©pendances sont installÃ©es

### 4. Base de donnÃ©es
- VÃ©rifier que la base est accessible
- Tester la connexion avant de migrer

## ğŸ“ SUPPORT

En cas de problÃ¨me :
1. VÃ©rifier les logs d'erreur
2. Consulter la documentation Flask-Migrate
3. VÃ©rifier la configuration de la base de donnÃ©es
4. S'assurer que tous les prÃ©requis sont satisfaits

## ğŸ”— LIENS UTILES

- [Documentation Flask-Migrate](https://flask-migrate.readthedocs.io/)
- [Documentation Alembic](https://alembic.sqlalchemy.org/)
- [Documentation SQLAlchemy](https://docs.sqlalchemy.org/)
- [Documentation Flask](https://flask.palletsprojects.com/)

## ğŸ“ NOTES IMPORTANTES

- Les migrations sont spÃ©cifiques Ã  l'environnement
- Ne jamais modifier manuellement les fichiers de migration
- Toujours tester sur un environnement de dÃ©veloppement
- Garder une trace des migrations appliquÃ©es
- Documenter les changements de schÃ©ma