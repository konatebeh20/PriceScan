# ========================================
# INSTRUCTIONS FLASK DB MIGRATE
# ========================================
# Compatible avec Windows, Linux et macOS
# ========================================

##  PR√âREQUIS OBLIGATOIRES

### 1. Python et pip install√©s
- Python 3.8+ requis
- pip doit √™tre accessible depuis le terminal

### 2. Environnement virtuel activ√©
```bash
# Windows (PowerShell/CMD)
venv\Scripts\activate

# Linux/macOS
source venv/bin/activate
```

### 3. D√©pendances install√©es
```bash
pip install -r requirements.txt
```

## üîß CONFIGURATION DE LA BASE DE DONN√âES

### Variables d'environnement requises
Cr√©er un fichier `.env` √† la racine du projet :

```env
# Configuration de base de donn√©es
DB_TYPE=mysql
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=
DB_NAME=PriceScan_db

# Ou pour SQLite (d√©veloppement)
DB_TYPE=sqlite
DB_PATH=./PriceScan.db

# Ou pour PostgreSQL
DB_TYPE=postgresql
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=your_password
DB_NAME=PriceScan_db
```

##  INSTRUCTIONS PAR SYST√àME D'EXPLOITATION

### ü™ü WINDOWS

#### Option 1: PowerShell
```powershell
# 1. Ouvrir PowerShell en tant qu'administrateur
# 2. Naviguer vers le dossier du projet
cd "C:\Users\konat\OneDrive\Bureau\project\accademique\M2\Dev web Mobile\PriceScan\PriceScan-api"

# 3. Activer l'environnement virtuel
.\venv\Scripts\Activate.ps1

# 4. V√©rifier que Flask-Migrate est install√©
pip show flask-migrate

# 5. Initialiser les migrations (premi√®re fois seulement)
flask db init

# 6. Cr√©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

#### Option 2: Command Prompt (CMD)
```cmd
# 1. Ouvrir CMD en tant qu'administrateur
# 2. Naviguer vers le dossier du projet
cd "C:\Users\konat\OneDrive\Bureau\project\accademique\M2\Dev web Mobile\PriceScan\PriceScan-api"

# 3. Activer l'environnement virtuel
venv\Scripts\activate.bat

# 4. V√©rifier que Flask-Migrate est install√©
pip show flask-migrate

# 5. Initialiser les migrations (premi√®re fois seulement)
flask db init

# 6. Cr√©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

### üêß LINUX

#### Ubuntu/Debian
```bash
# 1. Ouvrir un terminal
# 2. Naviguer vers le dossier du projet
cd /path/to/PriceScan-api

# 3. Activer l'environnement virtuel
source venv/bin/activate

# 4. V√©rifier que Flask-Migrate est install√©
pip show flask-migrate

# 5. Initialiser les migrations (premi√®re fois seulement)
flask db init

# 6. Cr√©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

#### CentOS/RHEL/Fedora
```bash
# 1. Ouvrir un terminal
# 2. Naviguer vers le dossier du projet
cd /path/to/PriceScan-api

# 3. Activer l'environnement virtuel
source venv/bin/activate

# 4. V√©rifier que Flask-Migrate est install√©
pip show flask-migrate

# 5. Initialiser les migrations (premi√®re fois seulement)
flask db init

# 6. Cr√©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

### üçé macOS

#### Terminal natif
```bash
# 1. Ouvrir Terminal
# 2. Naviguer vers le dossier du projet
cd /path/to/PriceScan-api

# 3. Activer l'environnement virtuel
source venv/bin/activate

# 4. V√©rifier que Flask-Migrate est install√©
pip show flask-migrate

# 5. Initialiser les migrations (premi√®re fois seulement)
flask db init

# 6. Cr√©er une migration
flask db migrate -m "Initial migration"

# 7. Appliquer la migration
flask db upgrade
```

## üõ†Ô∏è R√âSOLUTION DES PROBL√àMES COURANTS

### Erreur: "flask command not found"
**Solution:**
```bash
# Installer Flask-Migrate
pip install flask-migrate

# Ou utiliser python -m flask
python -m flask db migrate -m "Initial migration"
```

### Erreur: "No module named 'flask_migrate'"
**Solution:**
```bash
# Installer Flask-Migrate
pip install flask-migrate

# V√©rifier l'installation
pip list | grep flask
```

### Erreur: "No module named 'config'"
**Solution:**
```bash
# S'assurer d'√™tre dans le bon r√©pertoire
pwd  # Linux/macOS
cd   # Windows

# V√©rifier la structure des dossiers
ls -la  # Linux/macOS
dir     # Windows
```

### Erreur: "Database connection failed"
**Solution:**
1. V√©rifier que la base de donn√©es est en cours d'ex√©cution
2. V√©rifier les param√®tres de connexion dans `.env`
3. Tester la connexion manuellement

## üìÅ STRUCTURE DES MIGRATIONS

Apr√®s `flask db init`, la structure suivante sera cr√©√©e :

```
PriceScan-api/
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ versions/          # Fichiers de migration
‚îÇ   ‚îú‚îÄ‚îÄ alembic.ini       # Configuration Alembic
‚îÇ   ‚îú‚îÄ‚îÄ env.py            # Environnement de migration
‚îÇ   ‚îú‚îÄ‚îÄ README            # Documentation
‚îÇ   ‚îî‚îÄ‚îÄ script.py.mako    # Template pour les migrations
‚îú‚îÄ‚îÄ .env                  # Variables d'environnement
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ constant.py       # Configuration de la base
‚îÇ   ‚îî‚îÄ‚îÄ db.py            # Initialisation de la base
‚îî‚îÄ‚îÄ model/
    ‚îî‚îÄ‚îÄ PriceScan_db.py   # Mod√®les SQLAlchemy
```

##  COMMANDES MIGRATION COMPL√àTES

### Initialisation (premi√®re fois)
```bash
# Initialiser le syst√®me de migration
flask db init

# Cr√©er la premi√®re migration
flask db migrate -m "Initial database schema"

# Appliquer la migration
flask db upgrade
```

### Migrations suivantes
```bash
# Cr√©er une nouvelle migration
flask db migrate -m "Description des changements"

# Appliquer la migration
flask db upgrade

# Annuler la derni√®re migration
flask db downgrade
```

### Gestion des migrations
```bash
# Voir l'historique des migrations
flask db history

# Voir le statut actuel
flask db current

# Voir les migrations disponibles
flask db show
```

## üö® POINTS D'ATTENTION

### 1. Sauvegarde
- Toujours sauvegarder la base avant une migration
- Tester les migrations sur un environnement de d√©veloppement

### 2. Ordre des op√©rations
- Toujours faire `migrate` avant `upgrade`
- V√©rifier le contenu des migrations g√©n√©r√©es

### 3. Environnement
- S'assurer que l'environnement virtuel est activ√©
- V√©rifier que toutes les d√©pendances sont install√©es

### 4. Base de donn√©es
- V√©rifier que la base est accessible
- Tester la connexion avant de migrer

## üìû SUPPORT

En cas de probl√®me :
1. V√©rifier les logs d'erreur
2. Consulter la documentation Flask-Migrate
3. V√©rifier la configuration de la base de donn√©es
4. S'assurer que tous les pr√©requis sont satisfaits

## üîó LIENS UTILES

- [Documentation Flask-Migrate](https://flask-migrate.readthedocs.io/)
- [Documentation Alembic](https://alembic.sqlalchemy.org/)
- [Documentation SQLAlchemy](https://docs.sqlalchemy.org/)
- [Documentation Flask](https://flask.palletsprojects.com/)

## üìù NOTES IMPORTANTES

- Les migrations sont sp√©cifiques √† l'environnement
- Ne jamais modifier manuellement les fichiers de migration
- Toujours tester sur un environnement de d√©veloppement
- Garder une trace des migrations appliqu√©es
- Documenter les changements de sch√©ma